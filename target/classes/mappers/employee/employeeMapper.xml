<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="EmployeeDao">
  	<insert id="insertOneEmployeeDao" parameterType="EmployeeDto">  								
		INSERT INTO EMPLOYEE	(
									employeeNo
		                            , employeeName
		                            , employeePassWord
		                            , employeePhoneNumber
									, employeePostcode
		                            , employeeCommonaddress
		                            , employeeDetailaddress
		                            , employeeCompanyPhoneNumber
		                            , employeeEmail
		                            , employeeJoinDate
		                            , employeeRegisterDate
		                            , employeeModifyDate
		                            , salt
		                            , departmentNo
		                            , positionNo
								)
		VALUES					(
									#{employeeNo}
		                            , #{employeeName}
		                            , #{employeePassWord}
		                            , #{employeePhoneNumber}
		                            , #{employeePostcode}
		                            , #{employeeCommonaddress}
		                            , #{employeeDetailaddress}
		                            , #{employeeCompanyPhoneNumber}
		                            , #{employeeEmail}
		                            , #{employeeJoinDate}
		                            , now()
		                            , now()
		                            , #{salt}
		                            , #{departmentNo}
		                            , #{positionNo}
		                        )	  								
  	</insert>
  	
  	<select id="selectOneEmployeeDao" parameterType="EmployeeDto" resultType="EmployeeDto">
  		SELECT	employeeNo      
				, employeeName  
				, employeePassWord     
				, employeePhoneNumber     
				, employeePostcode     
				, employeeCommonaddress    
				, employeeDetailaddress    
				, employeeCompanyPhoneNumber    
				, employeeEmail 
				, employeeJoinDate
				, employeeRegisterDate 
				, employeeModifyDate 
  		FROM	EMPLOYEE
  		WHERE	employeeNo = #{employeeNo}
  		AND		employeePassWord = #{employeePassWord}
  	</select>
  	
  	<select id="getSaltByEmployeeNumber" parameterType="EmployeeDto" resultType="string">
  		SELECT	salt
  		FROM	EMPLOYEE
  		WHERE	employeeNo = #{employeeNo}
  	</select>
  	
  	<select id="selectMyDeployPayDao" parameterType="EmployeeDto" resultType="DeployPayDto">
        SELECT
              d.deployNo,
              d.deployDrafter,
              e.employeeName,
              d.deployDraftDate,
              d.deployPayer,
              d.deployPayRequestDate,
              d.deployPayDate
        FROM DEPLOYPAY d
      	JOIN EMPLOYEE e
        ON d.deployDrafter=e.employeeNo
        where d.deployPayer in (SELECT roleCode FROM authority WHERE employeeNo=#{employeeNo})
        AND d.deployPayDate is null
     </select>
     
     <update id="myDeployDoPayingOfCompleteNowPayDao" parameterType="DeployPayDto">
	      UPDATE    DeployPay
	      SET     
	              deployPayDate = now(),
	              deployDoingPayer = #{deployDoingPayer}
	      WHERE   deployNo = #{deployNo}
     </update>
     
     <insert id="myDeployDoPayingOfAddNextPayDao" parameterType="DeployPayDto">
	    INSERT INTO DEPLOYPAY(
	       deployNo,
	       deployDrafter,
	       deployDraftDate,
	       deployPayer,
	       deployPayRequestDate   
	    ) 
	    VALUES(
	       #{deployNo},
	       #{deployDrafter},
	       #{deployDraftDate},
	       #{deployPayer},
	       now()   
	    )
    </insert>
    
    <insert id="myDeployDoFinalCompleteOfPayDao" parameterType="DeployPayDto">
	     INSERT INTO DEPLOYPAY(
	       deployNo,
	       deployDrafter,
	       deployDraftDate,
	       deployPayer,
	       deployPayRequestDate,
	       deployPayDate,
	       deployDoingPayer   
	    ) 
	    VALUES(
	       #{deployNo},
	       #{deployDrafter},
	       #{deployDraftDate},
	       #{deployPayer},
	       now(),
	       now(),
	       #{deployDoingPayer}
	    )
    </insert>
    
    <update id="changeStatusCodeForDeloyDoPayingDao" parameterType="DeployRequestDto">
	    UPDATE DEPLOY
	    SET statusCode=#{statusCode}
	    WHERE deployNo=#{deployNo}
    </update>
    
  </mapper>