<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="DeployDao">
	<insert id="insertOneDeployDao" parameterType="DeployDto">
      INSERT INTO DEPLOY (
                         d_chainId
                        , wtype
                        , reqDate
                        , reqTime
                        , reqserviceId
                        , wEmpNo
                        , wContent
                        , reqEmpNo
                        , deployEmpNo
                        , devEmpNo
                        , testEmpNo
                        , prdEmpNo
                        , division
                        , statusCode
                        
                     )
      VALUES            (
                         #{d_chainId}
                        , #{wtype}
                        , #{reqDate}
                        , #{reqTime}
                        , #{reqServiceId}
                        , #{wEmpNo}
                        , #{wContent}
                        , #{reqEmpNo}
                        , #{deployEmpNo}
                        , #{devEmpNo}
                        , #{testEmpNo}
                        , #{prdEmpNo}
                        , #{division}
                        , "01"
                     )   
   </insert>
   
	<select id="selectAllDeployDao" resultType="DeployDto">
		SELECT 
	         d.deployNo
	         , c.chainName
	         , d.d_chainId
	         , d.wtype
	         , d.reqDate
	         , d.reqTime
	         , d.reqServiceId
	         , d.wContent
	         , d.reqEmpNo
	         , d.wEmpNo
	         , d.deployEmpNo
	         , d.devEmpNo
	         , d.testEmpNo
	         , d.prdEmpNo
	         , d.division
	         , d.statusCode  
		 FROM deploy d 
		 JOIN CHAINTABLE c
		 ON(d.d_chainID=c.chainID)
	</select>
	
	<select id="selectAllWProgramDao" resultType="WProgramTableDto" parameterType="_int" >
	SELECT
	       wProNo_pageId
	      ,wProNo_pageName
	      ,wProNo_deployNo
	FROM WPROGRAMTABLE
	WHERE wProNo_deployNo=#{deployNo}
	</select>
	
	<select id="selectAllWSourceDao" resultType="WSourceTableDto" parameterType="_int">
	SELECT
	      wSo_deployNo
	     ,wSo_wSourceName
	FROM WSOURCETABLE
	WHERE wSo_deployNo=#{deployNo}
	</select>
		
	<select id="selectOneDeployDao" parameterType="_int" resultType="DeployDto">
		SELECT 
	         d.deployNo
	         , d.d_chainId
	         , d.wtype
	         , d.reqDate
	         , d.reqTime
	         , d.reqServiceId
	         , d.wEmpNo
	         , d.wContent
	         , d.reqEmpNo
	         , d.deployEmpNo
	         , d.devEmpNo
	         , d.testEmpNo
	         , d.prdEmpNo
	         , d.division
	         , d.statusCode
	         , c.chainName
		 FROM deploy d 
		 JOIN CHAINTABLE c
		 ON (d.d_chainId=c.chainID)
		 WHERE d.deployNo=#{deployNo}
	</select>
	
	<update id="updateOneDeployDao" parameterType="DeployDto">
	  UPDATE    DEPLOY
      SET   
              d_chainId = #{d_chainId}       
            , wtype  = #{wtype}     
            , reqDate = #{reqDate}    
            , reqTime = #{reqTime}    
            , reqServiceId = #{reqServiceId}
            , wEmpNo = #{wEmpNo}
            , wContent = #{wContent}    
            , reqempNo = #{reqEmpNo}  
            , deployempNo = #{deployEmpNo}
            , devempNo = #{devEmpNo}  
            , testempNo = #{testEmpNo} 
            , prdempNo = #{prdEmpNo}  
            , division = #{division}
            , statusCode = #{statusCode}           
      WHERE   deployNo = #{deployNo}
	</update>
	
	<delete id="deleteOneDeployDao" parameterType="_int">
		DELETE
		FROM	DEPLOY
		WHERE	deployNo = #{deployNo}
	</delete>

	<select id="selectSomeDeployDao" parameterType="EmployeeDto" resultType="EmployeeDto">
      SELECT
            empNo
           , empName
      FROM EMPLOYEE
      WHERE empName=#{empName}
   </select>
   <select id="selectSomeChainDao" parameterType="ChainTableDto" resultType="ChainTableDto">
      SELECT
           chainId
          ,chainName
       FROM CHAINTABLE
       WHERE chainName LIKE CONCAT('%',#{chainName},'%')
   </select>      
   
   <select id="selectSomeProgramDao" parameterType="ProgramTableDto" resultType="ProgramTableDto">
      SELECT
            pageId
           , pageName
           , p_chainId
       FROM  PROGRAMTABLE
       WHERE pageName LIKE CONCAT('%',#{pageName},'%')
       AND p_chainId=#{paramChainId}
   </select>   
   
   <select id="selectAllChainDao" resultType="ChainTableDto">
   SELECT
   		 chainId
   	   , chainName
   FROM CHAINTABLE
   </select> 
   
   <select id="selectAllProgramDao" parameterType="ProgramTableDto" resultType="ProgramTableDto">
   SELECT
          pageId
         ,pageName
         ,p_chainId
   FROM  PROGRAMTABLE      
   WHERE p_chainId=#{paramChainId}
   </select>  
   
   <select id="selectMaxDeployNo" resultType="_int">
   SELECT
         MAX(deployNo)
   FROM DEPLOY
   </select>
   
   <insert id="insertOneWProgram" parameterType="WProgramTableDto">
  	 INSERT INTO WPROGRAMTABLE      (
                                 wProNo_pageId
                                 , wProNo_deployNo
                                 , wProNo_pageName
                              ) 
  	 VALUES
                              (
                                 #{wProNo_pageId}
                                 ,#{wProNo_deployNo}
                                 ,#{wProNo_pageName}
                              )
   </insert>
   
   <insert id="insertOneWSource" parameterType="WSourceTableDto">
   	INSERT INTO WSOURCETABLE         (
                                 wSo_deployNo
                                 , wSo_wSourceName
                              ) 
   	VALUES
                              (
                                 #{wSo_deployNo}
                                 ,#{wSo_wSourceName}
                              )
   </insert>
   
   
   <delete id="deleteAllWProgram" parameterType="_int">
   DELETE FROM WPROGRAMTABLE
   WHERE wProNo_deployNo=#{deployNo}
   </delete>
   
   <delete id="deleteAllWSource" parameterType="_int">
   DELETE FROM WSOURCETABLE
   WHERE wSo_deployNo=#{deployNo}
   </delete>
   
    <select id="selectSomeDeployCateListDao" parameterType="DeployCateListDto" resultType="DeployDto">
	SELECT 
     d.deployNo
	         , c.chainName
	         , d.d_chainId
	         , d.wtype
	         , d.reqDate
	         , d.reqTime
	         , d.reqServiceId
	         , d.wContent
	         , d.reqEmpNo
	         , d.wEmpNo
	         , d.deployEmpNo
	         , d.devEmpNo
	         , d.testEmpNo
	         , d.prdEmpNo
	         , d.division
	         , d.statusCode  
    FROM deploy d 
    JOIN CHAINTABLE c
	JOIN MASTERTABLE m
    ON(d.d_chainId=c.chainId)
    AND (d.statusCode=m.codeValue)
	WHERE 1=1
			AND d.d_chainId LIKE CONCAT(#{cateChain}, '%')
			AND d.wtype LIKE CONCAT(#{cateWtype}, '%')
			AND d.division LIKE CONCAT(#{cateDivision}, '%')
	        AND m.codeValue LIKE CONCAT(#{cateStatus}, '%') AND m.codeType="CTGY_STATUS"
	ORDER BY CASE WHEN #{cateReqDate} = '오름차순' THEN d.reqDate END ASC,
		     CASE WHEN #{cateReqDate} = '내림차순' THEN d.reqDate END DESC,
		     CASE WHEN #{cateReqDate} = '요청날짜' THEN d.reqDate END ASC;
    </select>
    
    <select id="selectAllMasterTableByStatusDao" resultType="MasterTableDto">
    	SELECT	
    			codeType
    			, codeValue
    			, codeName
		FROM 	MASTERTABLE
		WHERE	codeType = "STATUS"
    </select>
    
    <select id="selectAllCategoryDao" parameterType="string" resultType="MasterTableDto">
      SELECT
            codeType
            , codeValue
            , codeName
      FROM   MASTERTABLE
      WHERE   CODETYPE=#{codeType}
   </select>
   
    <select id="selectCategoryTypeDao" resultType="MasterTableDto">
       SELECT  DISTINCT(codeType)
      FROM   MASTERTABLE
      WHERE   codeType LIKE "CTGY%"   
    </select>
</mapper>                         
                                  
